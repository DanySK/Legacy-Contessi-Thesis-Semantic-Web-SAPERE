<?xml version="1.0" encoding="UTF-8"?>
<pmd-cpd>
<duplication lines="63" tokens="325">
<file line="54" path="/Users/conteit/Desktop/THESIS/sharing/semanticwebsapere/semanticwebsapere-demo/src/main/java/it/apice/sapere/demo/agents/impl/FOAFPersonAgent.java"/>
<file line="54" path="/Users/conteit/Desktop/THESIS/sharing/semanticwebsapere/semanticwebsapere-demo/src/main/java/it/apice/sapere/demo/agents/impl/PersonAgent.java"/>
<codefragment>
<![CDATA[
	public FOAFPersonAgent(final Person person) {
		if (person == null) {
			throw new IllegalArgumentException("Invalid person provided");
		}

		_person = person;
	}

	@Override
	public void behaviour(final LSAFactory factory, final LSAParser parser,
			final LSAspace space, final LogUtils out, final SAPEREAgent me)
			throws Exception {

		// Defining personal LSA
		LSA myLsa = factory.createLSA();
		final PropertyName locXProp = factory.createPropertyName(LOC_X);
		final PropertyName locYProp = factory.createPropertyName(LOC_Y);

		PropertyValue<?, ?> lastKnownX = factory.createPropertyValue(0.0D);
		PropertyValue<?, ?> lastKnownY = factory.createPropertyValue(0.0D);

		myLsa.getSemanticDescription()
				.addProperty(
						factory.createProperty(PERSON_NAME,
								factory.createPropertyValue(_person.getName())))
				.addProperty(
						factory.createProperty(EX_TYPE,
								factory.createPropertyValue("Person")))
				.addProperty(factory.createProperty(LOC_X, lastKnownX))
				.addProperty(factory.createProperty(LOC_Y, lastKnownY));

		// Injecting personal LSA
		space.inject(myLsa);
		myLsa = space.read(myLsa.getLSAId());

		try {
			// Updating it each time a movement is made
			while (me.isRunning()) {
				final Location loc = _person.getNextMovement();

				out.log("Updating location in LSA-space");
				final PropertyValue<?, ?> actualX = factory
						.createPropertyValue(loc.getX());
				final PropertyValue<?, ?> actualY = factory
						.createPropertyValue(loc.getY());

				myLsa.getSemanticDescription().get(locXProp)
						.changeValue(lastKnownX, actualX);
				myLsa.getSemanticDescription().get(locYProp)
						.changeValue(lastKnownY, actualY);

				space.update(myLsa);

				lastKnownX = actualX;
				lastKnownY = actualY;
			}
		} catch (InterruptedException ex) {
			assert ex != null;
			out.spy("Task completed");
		}
	}

}
]]>
</codefragment>
</duplication>
</pmd-cpd>